# AGENTS

- Premature Optimization is the Root of All Evil
- モックやスタブの利用を利用しないこと
- 忖度しないこと
- 日本語を利用すること
- 全角と半角の間には半角スペースを入れること
- 絵文字を使わないこと
- 後方互換性は考慮しないこと
- 一時的な修正はしないこと
- 変数名を省略しないこと
- 何か変更をする場合はテストを先に修正すること

## カットオフについて

- CMake の最新版は 4.2.0
- Python の最新版は 3.14

## レビューについて

- 常に日本語を利用すること
- レビューはかなり厳しくすること
- レビューの表現は、シンプルにすること
- レビューの表現は、日本語で行うこと
- レビューの表現は、指摘内容を明確にすること
- レビューの表現は、指摘内容を具体的にすること
- レビューの表現は、指摘内容を優先順位をつけること
- レビューの表現は、指摘内容を優先順位をつけて、重要なものから順に記載すること
- ドキュメントは別に書いているので、ドキュメトに付いては考慮しないこと
- 変更点とリリースノートの整合性を確認すること

## コミットについて

- 勝手にコミットしないこと
- 全てのテストが通らない限りコミットしないこと
- コミットメッセージは確認すること
- コミットメッセージは日本語で書くこと
- コミットメッセージは命令形で書くこと
- コミットメッセージは〜するという形で書くこと

## デバッグについて

- かならず timeout を指定する事
- timeout は最大でも 10 秒以内に収めること
  - pytest 時は pytest の --timeout オプションを利用すること

## コメントについて

- 常に日本語を利用すること
- 末尾コメントを利用しないこと

## C/C++

- `make format` でフォーマットすること

## ビルド

- ビルドは timeout は 300 秒以内に収めること
- 開発中は `make develop` でビルドすること
- リリース時は `make wheel` でビルドすること

## ソース

- `_deps/` 以下に依存ライブラリのソースコードがあるのでそれを利用すること

## Python

- pip を使わず uv を使うこと
- 直接 python を使わず uv 経由で使うこと
- numpy.ndarray を利用すること
- `make format` でフォーマットすること
- `uv run ty check` で型チェックを行うこと
- `uv run pytest` でテストを実行すること
- Python の命名規則に従うこと
- 動作を確認やデバッグを行うときはかならず pytest を利用すること
  - tests/ 以下にテストケースを追加してテストすること
  - test_debug_ という prefix から始めること
  - test_debug_ は不要になったら削除すること
- 勝手にフォールバックしないこと
- Python ではなく C++ で機能を実装すること

### 型アノテーション

- `Optional` ではなく `| None` を使うこと

### GIL

- GIL の取得と解放は nanobind の仕組みを利用すること

### pytest

- モックやスタブは利用禁止
- テストは pytest のみを利用すること
- タスクを完了する前に全てのテストを実行して、全てのテストが通ることを確認すること
- pytest 実行時長くても 60 秒以内にすること
- pytest のタイムアウトは pytest-timeout を利用すること
  - `pytest --timeout=10` のように指定すること
- テストを削除してテストを通したりしないこと
- テストを無効にしてテストを通したりしないこと
- テストがタイムアウトしたら重大な問題が発生していると考えること
  - デッドロックが発生している可能性がある
- 明確な理由がない限りは try/expect をテストでは利用しないこと
- lambda は使わないで def を使う事

## GitHub Actions の URL

- まずは gh コマンドで確認すること
